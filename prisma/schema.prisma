generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id               String            @id @default(cuid())
  username         String            @unique
  password         String
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  expenses         Expense[]
  incomes          Income[]
  people           Person[]
  categoryPayments CategoryPayment[]
  savings          Saving[]
  RecurringIncome  RecurringIncome[]
}

model Expense {
  id                String   @id @default(cuid())
  description       String
  amount            Float
  date              DateTime @default(now())
  category          String
  type              String   @default("SINGLE")
  installmentsTotal Int?     @default(1)
  installmentNumber Int?     @default(1)
  isShared          Boolean  @default(false)
  paidBy            String   @default("me")
  participants      Person[]
  isPaid            Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User?    @relation(fields: [userId], references: [id])
  userId            String?
}

model Income {
  id          String   @id @default(cuid())
  description String
  amount      Float
  date        DateTime @default(now())
  source      String
  type        String   @default("MONTHLY")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User?    @relation(fields: [userId], references: [id])
  userId      String?
  person      Person?  @relation(fields: [personId], references: [id])
  personId    String?

}

model RecurringIncome {
  id          String    @id @default(cuid())
  description String
  amount      Float
  source      String
  startDate   DateTime
  endDate     DateTime? // Null means indefinite
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  user        User?     @relation(fields: [userId], references: [id])
  userId      String?
  person      Person?   @relation(fields: [personId], references: [id])
  personId    String?
}

model Category {
  id       String            @id @default(cuid())
  name     String            @unique
  color    String            @default("#6366f1")
  icon     String            @default("Hash")
  payments CategoryPayment[]
}

model CategoryPayment {
  id         String   @id @default(cuid())
  categoryId String
  month      Int
  year       Int
  isPaid     Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  category Category @relation(fields: [categoryId], references: [id])
  user     User?    @relation(fields: [userId], references: [id])
  userId   String?

  @@unique([categoryId, month, year, userId])
}

model Saving {
  id          String   @id @default(cuid())
  amount      Float
  currency    String   @default("ARS")
  date        DateTime @default(now())
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User?    @relation(fields: [userId], references: [id])
  userId      String?
}

model Person {
  id        String    @id @default(cuid())
  name      String
  role      String    @default("ONETIME")
  expenses  Expense[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  user      User?     @relation(fields: [userId], references: [id])
  userId    String?
  incomes   Income[]
  recurringIncomes RecurringIncome[]
}
